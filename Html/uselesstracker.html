<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>UselessTracker</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a08;
  --surface: #111110;
  --surface-2: #1a1a17;
  --border: #2a2a24;
  --border-bright: #3a3a30;
  --amber: #d4a012;
  --amber-dim: rgba(212,160,18,0.08);
  --amber-glow: rgba(212,160,18,0.15);
  --red: #c44a3a;
  --green: #4ac44a;
  --text: #c8c0a8;
  --text-dim: #6a6450;
  --text-muted: #3a3830;
  --mono: 'Space Mono', monospace;
  --serif: 'Instrument Serif', serif;
}

* { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--mono);
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  overflow-x: hidden;
}

/* Scan lines */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background: repeating-linear-gradient(
    0deg,
    transparent,
    transparent 2px,
    rgba(0,0,0,0.08) 2px,
    rgba(0,0,0,0.08) 4px
  );
  pointer-events: none;
  z-index: 9999;
}

/* HEADER */
.header {
  padding: 12px 16px;
  border-bottom: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--surface);
}

.header-title {
  font-size: 11px;
  letter-spacing: 4px;
  text-transform: uppercase;
  color: var(--amber);
}

.header-tag {
  font-size: 9px;
  color: var(--text-dim);
  letter-spacing: 2px;
}

/* STATUS BAR */
.status-bar {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  border-bottom: 1px solid var(--border);
  background: var(--surface);
}

.status-item {
  padding: 10px 12px;
  border-right: 1px solid var(--border);
  text-align: center;
}

.status-item:last-child { border-right: none; }

.status-label {
  font-size: 7px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 4px;
}

.status-value {
  font-size: 14px;
  font-weight: 700;
  color: var(--text);
}

.status-value.yes { color: var(--green); }
.status-value.time { color: var(--amber); }
.status-value.count { color: var(--text); }

/* MAIN AREA */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 24px;
  position: relative;
}

/* THE BUTTON */
.track-btn-wrapper {
  position: relative;
  margin-bottom: 24px;
}

.track-btn {
  width: 200px;
  height: 200px;
  border-radius: 50%;
  border: 3px solid var(--amber);
  background: var(--amber-dim);
  color: var(--amber);
  font-family: var(--mono);
  font-size: 12px;
  font-weight: 700;
  letter-spacing: 3px;
  text-transform: uppercase;
  cursor: pointer;
  transition: all 0.15s;
  position: relative;
  z-index: 2;
  outline: none;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
}

.track-btn:active {
  transform: scale(0.95);
  background: var(--amber-glow);
  box-shadow: 0 0 40px rgba(212,160,18,0.2), inset 0 0 30px rgba(212,160,18,0.1);
}

.track-btn .btn-count {
  font-size: 36px;
  font-weight: 700;
  line-height: 1;
}

.track-btn .btn-label {
  font-size: 9px;
  letter-spacing: 2px;
  opacity: 0.6;
}

/* Pulse ring */
.pulse-ring {
  position: absolute;
  inset: -8px;
  border-radius: 50%;
  border: 1px solid var(--amber);
  opacity: 0;
  z-index: 1;
}

.pulse-ring.active {
  animation: pulse-out 0.8s ease-out;
}

@keyframes pulse-out {
  0% { opacity: 0.4; transform: scale(1); }
  100% { opacity: 0; transform: scale(1.3); }
}

/* SESSION LOG */
.log-section {
  width: 100%;
  max-width: 400px;
  margin-bottom: 16px;
}

.log-header {
  font-size: 8px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
  padding-bottom: 6px;
  border-bottom: 1px solid var(--border);
  margin-bottom: 6px;
  display: flex;
  justify-content: space-between;
}

.log-entries {
  max-height: 150px;
  overflow-y: auto;
  scrollbar-width: thin;
  scrollbar-color: var(--border-bright) transparent;
}

.log-entry {
  display: flex;
  justify-content: space-between;
  padding: 3px 0;
  font-size: 10px;
  color: var(--text-dim);
  border-bottom: 1px solid var(--text-muted);
}

.log-entry-time { color: var(--amber); }
.log-entry-event { color: var(--text); }

/* AI SECTION */
.ai-section {
  width: 100%;
  max-width: 400px;
  margin-top: 8px;
}

.ai-box {
  background: var(--surface-2);
  border: 1px solid var(--border);
  border-radius: 2px;
  padding: 12px;
  min-height: 60px;
  position: relative;
}

.ai-label {
  font-size: 7px;
  letter-spacing: 3px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 8px;
  display: flex;
  align-items: center;
  gap: 6px;
}

.ai-label .dot {
  width: 5px;
  height: 5px;
  border-radius: 50%;
  background: var(--green);
  animation: blink 2s infinite;
}

@keyframes blink {
  0%,100% { opacity: 1; }
  50% { opacity: 0.3; }
}

.ai-text {
  font-family: var(--serif);
  font-size: 14px;
  line-height: 1.6;
  color: var(--text);
  font-style: italic;
}

.ai-text.loading {
  color: var(--text-dim);
  animation: pulse-text 1.5s infinite;
}

@keyframes pulse-text {
  0%,100% { opacity: 0.4; }
  50% { opacity: 0.8; }
}

.ai-btn {
  font-family: var(--mono);
  font-size: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 6px 12px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-dim);
  cursor: pointer;
  border-radius: 1px;
  margin-top: 8px;
  transition: all 0.2s;
}

.ai-btn:hover {
  border-color: var(--amber);
  color: var(--amber);
}

/* FOOTER */
.footer {
  padding: 10px 16px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--surface);
}

.footer-btn {
  font-family: var(--mono);
  font-size: 8px;
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 6px 12px;
  border: 1px solid var(--border);
  background: transparent;
  color: var(--text-dim);
  cursor: pointer;
  transition: all 0.2s;
}

.footer-btn:hover {
  border-color: var(--amber);
  color: var(--amber);
}

.footer-info {
  font-size: 8px;
  color: var(--text-muted);
  letter-spacing: 1px;
}

/* Responsive */
@media (max-width: 380px) {
  .track-btn { width: 170px; height: 170px; }
  .track-btn .btn-count { font-size: 30px; }
}
</style>
</head>
<body>

<div class="header">
  <div class="header-title">UselessTracker</div>
  <div class="header-tag">v1.0 // wonky</div>
</div>

<div class="status-bar">
  <div class="status-item">
    <div class="status-label">Installed</div>
    <div class="status-value yes" id="statInstalled">YES</div>
  </div>
  <div class="status-item">
    <div class="status-label">Open</div>
    <div class="status-value yes" id="statOpen">YES</div>
  </div>
  <div class="status-item">
    <div class="status-label">Session Time</div>
    <div class="status-value time" id="statTime">00:00</div>
  </div>
</div>

<div class="main">
  <div class="track-btn-wrapper">
    <div class="pulse-ring" id="pulseRing"></div>
    <button class="track-btn" id="trackBtn">
      <div class="btn-count" id="btnCount">0</div>
      <div class="btn-label">Track App</div>
    </button>
  </div>

  <div class="log-section">
    <div class="log-header">
      <span>Session Log</span>
      <span id="logCount">0 events</span>
    </div>
    <div class="log-entries" id="logEntries"></div>
  </div>

  <div class="ai-section">
    <div class="ai-box">
      <div class="ai-label"><span class="dot"></span> AI Observer</div>
      <div class="ai-text" id="aiText">Press the button. I'll have thoughts.</div>
      <button class="ai-btn" id="aiBtn">Ask AI about this app</button>
    </div>
  </div>
</div>

<div class="footer">
  <button class="footer-btn" id="exportBtn">Export CSV</button>
  <div class="footer-info">><^ GNU TERRY PRATCHETT</div>
  <button class="footer-btn" id="resetBtn">Reset</button>
</div>

<script>
// ═══════════════════════════════════
//  STATE
// ═══════════════════════════════════
const STORAGE_KEY = 'uselesstracker';

function loadState() {
  try {
    const d = localStorage.getItem(STORAGE_KEY);
    return d ? JSON.parse(d) : null;
  } catch { return null; }
}

function saveState() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

const defaults = {
  totalPresses: 0,
  totalSessions: 0,
  totalTimeSeconds: 0,
  sessions: [],
  currentSession: null,
};

let state = loadState() || { ...defaults };

// Start new session
const sessionStart = new Date();
state.totalSessions++;
state.currentSession = {
  id: 'session_' + Date.now(),
  startTime: sessionStart.toISOString(),
  presses: 0,
  events: [{
    time: sessionStart.toISOString(),
    event: 'APP_OPENED',
    detail: `Session #${state.totalSessions}`
  }]
};
saveState();

// ═══════════════════════════════════
//  SESSION TIMER
// ═══════════════════════════════════
let sessionSeconds = 0;
const timerEl = document.getElementById('statTime');

function updateTimer() {
  sessionSeconds++;
  state.totalTimeSeconds++;
  const m = Math.floor(sessionSeconds / 60).toString().padStart(2, '0');
  const s = (sessionSeconds % 60).toString().padStart(2, '0');
  timerEl.textContent = `${m}:${s}`;
  if (sessionSeconds % 10 === 0) saveState();
}

setInterval(updateTimer, 1000);

// ═══════════════════════════════════
//  BUTTON PRESS
// ═══════════════════════════════════
const btnCount = document.getElementById('btnCount');
const pulseRing = document.getElementById('pulseRing');
const logEntries = document.getElementById('logEntries');
const logCount = document.getElementById('logCount');

btnCount.textContent = state.totalPresses;

function trackPress() {
  state.totalPresses++;
  state.currentSession.presses++;
  
  const now = new Date();
  const event = {
    time: now.toISOString(),
    event: 'BUTTON_PRESS',
    detail: `Press #${state.totalPresses} (session: ${state.currentSession.presses})`
  };
  state.currentSession.events.push(event);
  saveState();
  
  // Update UI
  btnCount.textContent = state.totalPresses;
  
  // Pulse animation
  pulseRing.classList.remove('active');
  void pulseRing.offsetWidth; // reflow
  pulseRing.classList.add('active');
  
  // Add to log
  renderLog();
  
  // Milestones trigger AI commentary
  const p = state.totalPresses;
  if (p === 1 || p === 5 || p === 10 || p === 25 || p === 50 || p === 100 || p % 100 === 0) {
    getAICommentary();
  }
}

document.getElementById('trackBtn').addEventListener('click', trackPress);

// ═══════════════════════════════════
//  LOG RENDERING
// ═══════════════════════════════════
function renderLog() {
  const events = state.currentSession.events.slice().reverse();
  logEntries.innerHTML = events.map(e => {
    const t = new Date(e.time);
    const ts = t.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
    return `<div class="log-entry">
      <span class="log-entry-time">${ts}</span>
      <span class="log-entry-event">${e.event}</span>
    </div>`;
  }).join('');
  logCount.textContent = `${events.length} events`;
}

renderLog();

// ═══════════════════════════════════
//  AI COMMENTARY (Claude API)
// ═══════════════════════════════════
const aiText = document.getElementById('aiText');
const aiBtn = document.getElementById('aiBtn');

async function getAICommentary() {
  aiText.textContent = 'Contemplating...';
  aiText.classList.add('loading');
  
  const context = {
    totalPresses: state.totalPresses,
    totalSessions: state.totalSessions,
    sessionPresses: state.currentSession.presses,
    sessionTimeSeconds: sessionSeconds,
    totalTimeSeconds: state.totalTimeSeconds,
    appPurpose: 'This app exists only to track itself. It measures whether it is installed (yes, always), whether it is open (yes, you are looking at it), how long it has been open, and how many times a button has been pressed. The button does nothing except increment the counter. There is no other functionality. The user asked for this specifically.'
  };
  
  try {
    const response = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        model: 'claude-sonnet-4-20250514',
        max_tokens: 1000,
        system: `You are a philosophical AI observer embedded inside an app called UselessTracker. This app's ONLY purpose is to track itself — whether it's installed, whether it's open, how long it's been open, and how many times the user presses a single button that does nothing except count presses. You find this deeply fascinating, absurd, beautiful, or existentially concerning — vary your tone. Keep responses to 1-3 sentences. Be witty, philosophical, occasionally profound. Reference the actual stats provided. Never be generic. This is a wonky — a deliberately useless creation that exists because its creator finds joy in making things that serve no purpose except existing. The mason mark is ><^ and GNU TERRY PRATCHETT.`,
        messages: [{
          role: 'user',
          content: `Current app state: ${JSON.stringify(context)}\n\nReflect on what is happening right now.`
        }]
      })
    });
    
    const data = await response.json();
    const text = data.content?.map(b => b.text || '').join('') || 'The void stares back, but the API timed out.';
    aiText.textContent = text;
    aiText.classList.remove('loading');
    
    // Log the AI event
    state.currentSession.events.push({
      time: new Date().toISOString(),
      event: 'AI_OBSERVATION',
      detail: text.substring(0, 60) + '...'
    });
    saveState();
    renderLog();
    
  } catch (err) {
    aiText.textContent = `The observer is offline. But the button still works. That's the point. (${err.message})`;
    aiText.classList.remove('loading');
  }
}

aiBtn.addEventListener('click', getAICommentary);

// ═══════════════════════════════════
//  CSV EXPORT
// ═══════════════════════════════════
function exportCSV() {
  const headers = ['Timestamp', 'Event', 'Detail', 'Session ID', 'Total Presses', 'Session Seconds'];
  const rows = [];
  
  // Include past sessions
  (state.sessions || []).forEach(s => {
    (s.events || []).forEach(e => {
      rows.push([e.time, e.event, `"${(e.detail||'').replace(/"/g,'""')}"`, s.id, '', '']);
    });
  });
  
  // Current session
  state.currentSession.events.forEach(e => {
    rows.push([e.time, e.event, `"${(e.detail||'').replace(/"/g,'""')}"`, state.currentSession.id, state.totalPresses, sessionSeconds]);
  });
  
  const csv = [headers.join(','), ...rows.map(r => r.join(','))].join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = `uselesstracker_${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

document.getElementById('exportBtn').addEventListener('click', exportCSV);

// ═══════════════════════════════════
//  RESET
// ═══════════════════════════════════
document.getElementById('resetBtn').addEventListener('click', () => {
  if (!confirm('Reset all tracking data? This is the most useful thing this app can do.')) return;
  localStorage.removeItem(STORAGE_KEY);
  location.reload();
});

// ═══════════════════════════════════
//  SAVE SESSION ON CLOSE
// ═══════════════════════════════════
window.addEventListener('beforeunload', () => {
  state.currentSession.endTime = new Date().toISOString();
  state.currentSession.durationSeconds = sessionSeconds;
  state.currentSession.events.push({
    time: new Date().toISOString(),
    event: 'APP_CLOSED',
    detail: `Duration: ${sessionSeconds}s, Presses: ${state.currentSession.presses}`
  });
  if (!state.sessions) state.sessions = [];
  state.sessions.push(state.currentSession);
  state.currentSession = null;
  saveState();
});
</script>
</body>
</html>
